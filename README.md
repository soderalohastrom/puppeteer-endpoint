# Puppeteer PDF Service

A standalone microservice for generating screenshots and PDFs using Puppeteer. This service provides API endpoints for creating screenshots from HTML content or URLs, and generating PDFs from those screenshots.

## Service Overview

- **Production URL**: https://next-dev.kelleher-international.com/puppeteer
- **Local Development URL**: http://localhost:3500
- **Test Server URL**: http://localhost:3002 (for sample slides)

## Endpoints and Status

| Method | Endpoint | Description | Status |
|--------|----------|-------------|--------|
| GET | `/health` | Health check endpoint | ✅ WORKS |
| GET | `/` | Root endpoint | ✅ WORKS |
| GET | `/get-latest-pdf` | Get the URL of the most recently generated PDF | ✅ WORKS |
| POST | `/screenshot` | Generate a screenshot from HTML content | ✅ WORKS |
| POST | `/screenshots` | Generate screenshots from multiple URLs | ✅ WORKS |
| POST | `/generate-pdf` | Generate a PDF from images | ✅ WORKS |
| POST | `/export-slides` | Generate a PDF from slide URLs (one-step process) | ✅ WORKS |

## Usage Examples

### Health Check

```bash
curl https://next-dev.kelleher-international.com/puppeteer/health
```

Response:
```json
{
  "status": "ok",
  "message": "Puppeteer service is running"
}
```

### Screenshot from HTML

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "html": "<!DOCTYPE html><html><head><title>Test</title></head><body><h1>Test Screenshot</h1><p>This is a test screenshot from HTML content.</p></body></html>",
    "options": {
      "width": 1024,
      "height": 768,
      "scale": 2,
      "fullPage": false
    }
  }' \
  https://next-dev.kelleher-international.com/puppeteer/screenshot
```

### Screenshots from URLs

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "urls": [
      "https://example.com",
      "https://google.com"
    ],
    "dimensions": {
      "width": 1920,
      "height": 1080
    },
    "format": "jpeg",
    "quality": 90
  }' \
  https://next-dev.kelleher-international.com/puppeteer/screenshots
```

### Export Slides to PDF

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Accept: application/pdf" \
  -d '{
    "urls": [
      "https://next-dev.kelleher-international.com/slide/1",
      "https://next-dev.kelleher-international.com/slide/2",
      "https://next-dev.kelleher-international.com/slide/3",
      "https://next-dev.kelleher-international.com/slide/4"
    ],
    "dimensions": {
      "width": 1920,
      "height": 1080
    },
    "quality": 100
  }' \
  --output slides.pdf \
  https://next-dev.kelleher-international.com/puppeteer/export-slides
```

## Usage Notes and Best Practices

### 1. Generate PDF from Images Endpoint

The `/generate-pdf` endpoint requires server-side paths to images that already exist on the server:

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "imagePaths": [
      "/home/ubuntu/puppeteer-service/output/slide-1-8355b6da-fe5e-4e59-9e90-6ccf4bb53e7b.jpg",
      "/home/ubuntu/puppeteer-service/output/slide-2-8e191299-49ac-4676-90c7-868f89ee7451.jpg"
    ],
    "dimensions": {
      "width": 1920,
      "height": 1080
    }
  }' \
  --output document.pdf \
  https://next-dev.kelleher-international.com/puppeteer/generate-pdf
```

⚠️ **Important**: This endpoint requires absolute file paths to images on the server. It's primarily intended for server-side workflows where images have already been generated by the `/screenshots` endpoint. For a more convenient solution that works with publicly accessible URLs, use the `/export-slides` endpoint.

### 2. Export Slides to PDF Endpoint

For the `/export-slides` endpoint, ensure you're using the correct URLs for the slides:

```bash
# For local testing with test-server.js
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Accept: application/pdf" \
  -d '{
    "urls": [
      "http://localhost:3002/slide/1",
      "http://localhost:3002/slide/2",
      "http://localhost:3002/slide/3",
      "http://localhost:3002/slide/4"
    ],
    "dimensions": {
      "width": 1920,
      "height": 1080
    },
    "quality": 100
  }' \
  --output slides.pdf \
  http://localhost:3500/export-slides
```

For the production API, these should be exposed through Nginx at:

```
https://next-dev.kelleher-international.com/slide/1
https://next-dev.kelleher-international.com/slide/2
https://next-dev.kelleher-international.com/slide/3
https://next-dev.kelleher-international.com/slide/4
```

## Service Configuration

The service runs on port 3500 and is configured via environment variables:

- `PORT`: Port to run the service on (default: 3500)
- `NODE_ENV`: Environment setting (development/production)

## Testing

### Local Testing

1. Start the service:
   ```bash
   node index.js
   ```

2. Start the test server (provides sample slides):
   ```bash
   node test-server.js
   ```

3. Use the provided Postman collection (`Puppeteer-Service-Postman.json`) for testing endpoints.

### Production Testing

Import the Postman collection and update the host to:
`https://next-dev.kelleher-international.com/puppeteer`

## Future Improvements

1. Add an endpoint to generate PDFs from publicly accessible image URLs
2. Improve error handling and validation
3. Add rate limiting for production use
4. Add authentication for sensitive endpoints
5. Update Nginx configuration to properly expose test slides at `/slide/{number}`
6. Consider adding a simple UI for testing and demonstration

## Deployment

The service is deployed using PM2:

```bash
pm2 start index.js --name puppeteer-service
pm2 save
```

To check the status:
```bash
pm2 list
pm2 logs puppeteer-service
```

## License

MIT

---

Made with ❤️ for slide presentation applications
